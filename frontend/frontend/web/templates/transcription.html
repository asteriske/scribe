{% extends "base.html" %}

{% block title %}{{ transcription.title or 'Transcription' }} - Scribe{% endblock %}

{% block content %}
<div class="transcription-detail">
    <div class="transcription-header">
        <h2>{{ transcription.title or 'Untitled' }}</h2>

        {% if transcription.channel %}
        <p class="channel">{{ transcription.channel }}</p>
        {% endif %}

        <div class="meta">
            <span class="status status-{{ transcription.status }}">
                {{ transcription.status }}
            </span>

            {% if transcription.duration_seconds %}
            <span class="duration">
                {{ (transcription.duration_seconds / 60) | round(1) }} minutes
            </span>
            {% endif %}

            {% if transcription.language %}
            <span class="language">{{ transcription.language }}</span>
            {% endif %}

            {% if transcription.word_count %}
            <span class="word-count">{{ transcription.word_count }} words</span>
            {% endif %}
        </div>
    </div>

    {% if transcription.status == 'completed' %}
    <div class="export-buttons">
        <a href="/api/transcriptions/{{ transcription.id }}/export/json" class="btn">
            ğŸ“„ JSON
        </a>
        <a href="/api/transcriptions/{{ transcription.id }}/export/txt" class="btn">
            ğŸ“ TXT
        </a>
        <a href="/api/transcriptions/{{ transcription.id }}/export/srt" class="btn">
            ğŸ¬ SRT
        </a>
    </div>

    <div class="transcription-text">
        <h3>Transcription</h3>
        <div class="segments">
            {% for segment in segments %}
            <div class="segment">
                <span class="timestamp">{{ segment.start | format_time }}</span>
                <span class="text">{{ segment.text }}</span>
            </div>
            {% endfor %}
        </div>
    </div>

    {% elif transcription.status == 'failed' %}
    <div class="error-message">
        <h3>Transcription Failed</h3>
        <p>{{ transcription.error_message }}</p>
    </div>

    {% else %}
    <div class="processing-message">
        <h3>Processing...</h3>
        <div class="progress-bar">
            <div class="progress-fill" style="width: {{ transcription.progress }}%"></div>
        </div>
        <p>{{ transcription.status }} - {{ transcription.progress }}%</p>
    </div>
    {% endif %}

    <div class="actions">
        <a href="/" class="btn">â† Back to Home</a>
        <button onclick="deleteTranscription('{{ transcription.id }}')" class="btn btn-danger">
            ğŸ—‘ï¸ Delete
        </button>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function deleteTranscription(id) {
    if (confirm('Are you sure you want to delete this transcription?')) {
        fetch(`/api/transcriptions/${id}`, {
            method: 'DELETE'
        })
        .then(response => {
            if (response.ok) {
                window.location.href = '/';
            } else {
                alert('Failed to delete transcription');
            }
        });
    }
}
</script>
{% endblock %}
